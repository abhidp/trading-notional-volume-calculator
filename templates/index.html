{% extends "base.html" %} {% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card shadow">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">
          <i class="bi bi-calculator me-2"></i>Trading Notional Volume
          Calculator
        </h4>
      </div>
      <div class="card-body">
        <p class="text-muted mb-4">
          Upload your trade history export file to calculate total notional
          trading volume in USD. Supports MetaTrader 5 and cTrader platforms.
        </p>

        <form
          action="{{ url_for('upload') }}"
          method="post"
          enctype="multipart/form-data"
          id="uploadForm"
        >
          <!-- Platform Selector -->
          <div class="mb-4">
            <label for="platform" class="form-label fw-semibold">
              <i class="bi bi-gear me-1"></i>Platform
            </label>
            <select class="form-select" id="platform" name="platform">
              <option value="auto" selected>Auto-Detect</option>
              {% for platform in platforms %}
              <option value="{{ platform }}">{{ platform.upper() }}</option>
              {% endfor %}
            </select>
            <div class="form-text">
              Select your trading platform or let us auto-detect it.
            </div>
          </div>

          <!-- File Upload -->
          <div class="mb-4">
            <label for="file" class="form-label fw-semibold">
              <i class="bi bi-file-earmark-arrow-up me-1"></i>Trade History File
            </label>
            <div class="upload-area" id="uploadArea">
              <input
                type="file"
                class="form-control d-none"
                id="file"
                name="file"
                accept=".xlsx,.csv"
                required
              />
              <div class="upload-content text-center py-5">
                <i class="bi bi-cloud-arrow-up display-1 text-muted"></i>
                <p class="mt-3 mb-1">Drag & drop your file here</p>
                <p class="text-muted small">or click to browse</p>
                <p class="text-muted small mb-0">
                  <i class="bi bi-file-earmark-excel me-1"></i>Supported: .xlsx,
                  .csv
                </p>
              </div>
              <div class="file-info text-center py-4 d-none">
                <i class="bi bi-file-earmark-check display-4 text-success"></i>
                <p class="mt-2 mb-0 fw-semibold file-name"></p>
                <button
                  type="button"
                  class="btn btn-sm btn-outline-secondary mt-2"
                  id="clearFile"
                >
                  <i class="bi bi-x me-1"></i>Clear
                </button>
              </div>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="d-grid">
            <button
              type="submit"
              class="btn btn-primary btn-lg"
              id="submitBtn"
              disabled
            >
              <i class="bi bi-calculator me-2"></i>Calculate Notional Volume
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Privacy & Data Handling -->
    <div class="card mt-4 border-success">
      <div class="card-header bg-success bg-opacity-10 border-success">
        <h6 class="mb-0 text-success">
          <i class="bi bi-shield-check me-2"></i>Privacy & Data Handling
        </h6>
      </div>
      <div class="card-body">
        <p class="small text-muted mb-3">
          We understand that trading history contains sensitive information.
          Here's how we handle your data:
        </p>
        <ul class="list-unstyled small mb-3">
          <li class="mb-2">
            <i class="bi bi-check-circle-fill text-success me-2"></i>
            <strong>No Storage</strong> — Your files are processed in memory and
            never saved to our servers
          </li>
          <li class="mb-2">
            <i class="bi bi-check-circle-fill text-success me-2"></i>
            <strong>No Tracking</strong> — We don't collect personal
            information, account numbers, or broker details
          </li>
          <li class="mb-2">
            <i class="bi bi-check-circle-fill text-success me-2"></i>
            <strong>No Sharing</strong> — Your data is never shared with third
            parties
          </li>
          <li class="mb-2">
            <i class="bi bi-check-circle-fill text-success me-2"></i>
            <strong>Session Only</strong> — All data is cleared when you close
            your browser
          </li>
          <li class="mb-2">
            <i class="bi bi-check-circle-fill text-success me-2"></i>
            <strong>Edit Manually</strong> — If still unsure, you can manually delete
            your personal data from the statements before uploading
          </li>
          <li class="mb-2">
            <i class="bi bi-check-circle-fill text-success me-2"></i>
            <strong>Open Source</strong> — Our code is publicly available for
            audit on
            <a
              href="https://github.com/abhidp/trading-notional-volume-calculator"
              target="_blank"
              class="text-decoration-none"
              >GitHub
              <i class="bi bi-box-arrow-up-right" style="font-size: 0.7rem"></i
            ></a>
          </li>
        </ul>
        <div class="alert alert-light border small mb-0 py-2">
          <i class="bi bi-terminal me-2"></i>
          <strong>Prefer offline?</strong> Clone our
          <a
            href="https://github.com/abhidp/trading-notional-volume-calculator"
            target="_blank"
            class="text-decoration-none"
            >GitHub repo</a
          >
          and run the CLI version locally — no data ever leaves your machine.
        </div>
      </div>
    </div>

    <!-- Supported Platforms Info -->
    <div class="card mt-4">
      <div class="card-body">
        <h6 class="card-title">
          <i class="bi bi-info-circle me-2"></i>Supported Platforms
        </h6>
        <div class="row">
          <div class="col-md-6">
            <span class="badge bg-primary me-2">MT5</span>
            <small class="text-muted"
              >MetaTrader 5 - Export from History tab</small
            >
          </div>
          <div class="col-md-6">
            <span class="badge bg-success me-2">cTrader</span>
            <small class="text-muted">cTrader - Export from History</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  const uploadArea = document.getElementById('uploadArea')
  const fileInput = document.getElementById('file')
  const uploadContent = uploadArea.querySelector('.upload-content')
  const fileInfo = uploadArea.querySelector('.file-info')
  const fileName = uploadArea.querySelector('.file-name')
  const clearBtn = document.getElementById('clearFile')
  const submitBtn = document.getElementById('submitBtn')

  // Click to browse
  uploadArea.addEventListener('click', () => fileInput.click())

  // Drag and drop
  uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault()
    uploadArea.classList.add('drag-over')
  })

  uploadArea.addEventListener('dragleave', () => {
    uploadArea.classList.remove('drag-over')
  })

  uploadArea.addEventListener('drop', (e) => {
    e.preventDefault()
    uploadArea.classList.remove('drag-over')
    const files = e.dataTransfer.files
    if (files.length > 0) {
      fileInput.files = files
      showFileInfo(files[0])
    }
  })

  // File input change
  fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) {
      showFileInfo(fileInput.files[0])
    }
  })

  // Clear file
  clearBtn.addEventListener('click', (e) => {
    e.stopPropagation()
    fileInput.value = ''
    hideFileInfo()
  })

  function showFileInfo(file) {
    fileName.textContent = file.name
    uploadContent.classList.add('d-none')
    fileInfo.classList.remove('d-none')
    submitBtn.disabled = false
  }

  function hideFileInfo() {
    uploadContent.classList.remove('d-none')
    fileInfo.classList.add('d-none')
    submitBtn.disabled = true
  }

  // Form submission - show loading
  document.getElementById('uploadForm').addEventListener('submit', function () {
    submitBtn.innerHTML =
      '<span class="spinner-border spinner-border-sm me-2"></span>Processing...'
    submitBtn.disabled = true
  })
</script>
{% endblock %}
